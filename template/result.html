<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction Results | Student Drift Detection</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/graph-up-arrow.svg">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container-fluid min-vh-100 bg-light">
        <div class="container py-5">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12 text-center">
                    <div class="p-4 bg-primary text-white rounded-3 shadow-sm">
                        <h1 class="display-5 fw-bold mb-2">
                            <i class="bi bi-clipboard-check"></i> Prediction Results
                        </h1>
                        <p class="lead text-white-50 mb-0">Analysis of student learning patterns</p>
                    </div>
                </div>
            </div>

            <!-- Main Results -->
            <div class="row g-4 mb-4">
                <!-- Risk Status Card -->
                <div class="col-md-6 col-lg-3">
                    <div class="card shadow-lg border-0 h-100 {% if risk == 'Pass' %}border-success border-3{% else %}border-danger border-3{% endif %}">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                {% if risk == 'Pass' %}
                                <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                                {% else %}
                                <i class="bi bi-x-circle-fill text-danger" style="font-size: 3rem;"></i>
                                {% endif %}
                            </div>
                            <h6 class="text-muted text-uppercase small mb-2">Risk Status</h6>
                            <h3 class="fw-bold {% if risk == 'Pass' %}text-success{% else %}text-danger{% endif %}">
                                {{ risk }}
                            </h3>
                            <span class="badge {% if risk == 'Pass' %}bg-success{% else %}bg-danger{% endif %} mt-2">
                                {% if risk == 'Pass' %}Low Risk{% else %}High Risk{% endif %}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Predicted Final Grade Card -->
                <div class="col-md-6 col-lg-3">
                    <div class="card shadow-lg border-0 h-100">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-trophy-fill text-warning" style="font-size: 3rem;"></i>
                            </div>
                            <h6 class="text-muted text-uppercase small mb-2">Predicted Final Grade</h6>
                            <h2 class="fw-bold text-primary mb-3">{{ final_grade }}/20</h2>
                            <!-- Progress Bar -->
                            <div class="progress" style="height: 25px;">
                            {% set percentage = (final_grade / 20 * 100)|round(1) %}
                                <div class="progress-bar {% if final_grade >= 10 %}bg-success{% elif final_grade >= 5 %}bg-warning{% else %}bg-danger{% endif %}" 
                                    role="progressbar" 
                                    style="width: {{ percentage }}%"
                                    aria-valuenow="{{ final_grade }}" 
                                    aria-valuemin="0" 
                                    aria-valuemax="20">
                                    {{ percentage }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Behavior Cluster Card -->
                <div class="col-md-6 col-lg-3">
                    <div class="card shadow-lg border-0 h-100">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                <i class="bi bi-diagram-3-fill text-info" style="font-size: 3rem;"></i>
                            </div>
                            <h6 class="text-muted text-uppercase small mb-2">Behavior Cluster</h6>
                            <h2 class="fw-bold text-info mb-3">Cluster {{ cluster }}</h2>
                            <span class="badge bg-info fs-6">Pattern Group {{ cluster }}</span>
                        </div>
                    </div>
                </div>

                <!-- Behavioral Drift Card -->
                <div class="col-md-6 col-lg-3">
                    <div class="card shadow-lg border-0 h-100 {% if drift_status == 'Positive' %}border-success border-3{% elif drift_status == 'Negative' %}border-danger border-3{% else %}border-info border-3{% endif %}">
                        <div class="card-body text-center p-4">
                            <div class="mb-3">
                                {% if drift_status == 'Positive' %}
                                <i class="bi bi-arrow-up-circle-fill text-success" style="font-size: 3rem;"></i>
                                {% elif drift_status == 'Negative' %}
                                <i class="bi bi-arrow-down-circle-fill text-danger" style="font-size: 3rem;"></i>
                                {% else %}
                                <i class="bi bi-dash-circle-fill text-info" style="font-size: 3rem;"></i>
                                {% endif %}
                            </div>
                            <h6 class="text-muted text-uppercase small mb-2">Behavioral Drift</h6>
                            <h3 class="fw-bold {% if drift_status == 'Positive' %}text-success{% elif drift_status == 'Negative' %}text-danger{% else %}text-info{% endif %} mb-2">
                                {{ drift }}
                            </h3>
                            <span class="badge {% if drift_status == 'Positive' %}bg-success{% elif drift_status == 'Negative' %}bg-danger{% else %}bg-info{% endif %}">
                                {{ drift_status }}
                            </span>
                            <p class="small text-muted mt-2 mb-0">{{ drift_description }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Summary -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><i class="bi bi-list-ul"></i> Input Summary</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Study Time:</span>
                                        <strong>{{ studytime }} hrs/week</strong>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Absences:</span>
                                        <strong>{{ absences }}</strong>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Past Failures:</span>
                                        <strong>{{ failures }}</strong>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">G1 Grade:</span>
                                        <strong>{{ G1 }}/20</strong>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">G2 Grade:</span>
                                        <strong>{{ G2 }}/20</strong>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex justify-content-between">
                                        <span class="text-muted">Drift (G2-G1):</span>
                                        <strong class="{% if drift > 2 %}text-success{% elif drift < -2 %}text-danger{% else %}text-info{% endif %}">
                                            {{ drift }}
                                        </strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Comparison Table -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Model Comparison</h5>
                        </div>
                        <div class="card-body">
                            <!-- Classification Models -->
                            <h6 class="text-muted mb-3"><i class="bi bi-diagram-2"></i> Classification Models (Pass/Fail Prediction)</h6>
                            <div class="table-responsive mb-4">
                                <table class="table table-hover table-bordered">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Model Name</th>
                                            <th>Accuracy (%)</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for model in classification_models %}
                                        <tr class="{% if model.selected %}table-success{% endif %}">
                                            <td>
                                                {{ model.name }}
                                                {% if model.selected %}
                                                <span class="badge bg-success ms-2">Selected</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="progress flex-grow-1 me-2" style="height: 20px;">
                                                        <div class="progress-bar {% if model.selected %}bg-success{% else %}bg-info{% endif %}" 
                                                             role="progressbar" 
                                                             style="width: {{ model.accuracy }}%"
                                                             aria-valuenow="{{ model.accuracy }}" 
                                                             aria-valuemin="0" 
                                                             aria-valuemax="100">
                                                            {{ model.accuracy }}%
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                {% if model.selected %}
                                                <span class="badge bg-success">In Use</span>
                                                {% else %}
                                                <span class="badge bg-secondary">Tested</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Regression Models -->
                            <h6 class="text-muted mb-3"><i class="bi bi-graph-up"></i> Regression Models (Final Grade Prediction)</h6>
                            <div class="table-responsive">
                                <table class="table table-hover table-bordered">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Model Name</th>
                                            <th>RMSE</th>
                                            <th>R² Score</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for model in regression_models %}
                                        <tr class="{% if model.selected %}table-success{% endif %}">
                                            <td>
                                                {{ model.name }}
                                                {% if model.selected %}
                                                <span class="badge bg-success ms-2">Selected</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ "%.2e"|format(model.rmse) }}</td>
                                            <td>
                                                <span class="badge bg-primary">{{ model.r2 }}</span>
                                            </td>
                                            <td>
                                                {% if model.selected %}
                                                <span class="badge bg-success">In Use</span>
                                                {% else %}
                                                <span class="badge bg-secondary">Tested</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div class="alert alert-info mt-3 mb-0">
                                <i class="bi bi-info-circle"></i> <strong>Note:</strong> Random Forest was selected for classification (96.2% accuracy) and Linear Regression for regression (R²=1.0) based on performance evaluation.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visualizations Section -->
            <div class="row g-4 mb-4">
                <!-- Cluster Visualization -->
                <div class="col-lg-6">
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="bi bi-diagram-3"></i> Cluster Analysis - Your Behavioral Profile</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <h6 class="text-primary">{{ cluster_info.name }} (Cluster {{ cluster }})</h6>
                                <p class="text-muted small">{{ cluster_info.description }}</p>
                                <div class="mt-3">
                                    <strong class="text-muted">Key Characteristics:</strong>
                                    <ul class="list-unstyled mt-2">
                                        {% for char in cluster_info.characteristics %}
                                        <li><i class="bi bi-check-circle text-success"></i> {{ char }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                            <canvas id="clusterChart" style="max-height: 300px;"></canvas>
                            <div class="alert alert-light mt-3 mb-0">
                                <small class="text-muted">
                                    <i class="bi bi-lightbulb"></i> <strong>Why Cluster {{ cluster }}?</strong> 
                                    Your combination of study time ({{ studytime }} hrs), absences ({{ absences }}), 
                                    failures ({{ failures }}), and grades (G1: {{ G1 }}, G2: {{ G2 }}) places you in this behavioral group.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grade Progression Chart -->
                <div class="col-lg-6">
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0"><i class="bi bi-graph-up-arrow"></i> Grade Progression & Prediction</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="gradeChart" style="max-height: 300px;"></canvas>
                            <div class="mt-3">
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="border-end">
                                            <div class="text-muted small">G1</div>
                                            <div class="h5 mb-0">{{ G1 }}/20</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="border-end">
                                            <div class="text-muted small">G2</div>
                                            <div class="h5 mb-0">{{ G2 }}/20</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div>
                                            <div class="text-muted small">Predicted G3</div>
                                            <div class="h5 mb-0 text-primary">{{ final_grade }}/20</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-light mt-3 mb-0">
                                <small class="text-muted">
                                    <i class="bi bi-info-circle"></i> This chart shows your grade progression from G1 to G2, 
                                    and the predicted final grade (G3) based on your learning patterns.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feature Comparison Radar Chart -->
                <div class="col-lg-6">
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="bi bi-radar"></i> Feature Profile Comparison</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="featureChart" style="max-height: 300px;"></canvas>
                            <div class="alert alert-light mt-3 mb-0">
                                <small class="text-muted">
                                    <i class="bi bi-info-circle"></i> This radar chart shows your profile across key features 
                                    compared to typical cluster patterns. Higher values indicate better performance indicators.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Drift Visualization -->
                <div class="col-lg-6">
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-header bg-danger text-white">
                            <h5 class="mb-0"><i class="bi bi-arrow-left-right"></i> Behavioral Drift Analysis</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="driftChart" style="max-height: 300px;"></canvas>
                            <div class="mt-3 text-center">
                                <div class="d-inline-block p-3 rounded {% if drift_status == 'Positive' %}bg-success{% elif drift_status == 'Negative' %}bg-danger{% else %}bg-info{% endif %} text-white">
                                    <div class="small">Drift Value</div>
                                    <div class="h4 mb-0">{{ drift }}</div>
                                    <div class="small mt-1">{{ drift_status }}</div>
                                </div>
                            </div>
                            <div class="alert alert-light mt-3 mb-0">
                                <small class="text-muted">
                                    <i class="bi bi-info-circle"></i> Drift = G2 - G1. 
                                    Positive values (>2) indicate improvement, negative values (<-2) indicate decline, 
                                    and values between -2 and 2 indicate stable performance.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Explanations Section -->
            <div class="row g-4 mb-4">
                <!-- Risk Prediction Explanation -->
                <div class="col-md-4">
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-body">
                            <h5 class="card-title text-primary">
                                <i class="bi bi-shield-check"></i> Risk Prediction
                            </h5>
                            <p class="card-text text-muted">
                                The risk prediction indicates whether the student is likely to <strong>pass</strong> or <strong>fail</strong> 
                                the course based on their learning patterns. This is determined by analyzing study habits, 
                                attendance, past performance, and grade progression.
                            </p>
                            <p class="card-text">
                                <small class="text-muted">
                                    <strong>Current Status:</strong> 
                                    <span class="badge {% if risk == 'Pass' %}bg-success{% else %}bg-danger{% endif %}">
                                        {{ risk }}
                                    </span>
                                </small>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Behavioral Drift Explanation -->
                <div class="col-md-4">
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-body">
                            <h5 class="card-title text-primary">
                                <i class="bi bi-arrow-left-right"></i> Behavioral Drift
                            </h5>
                            <p class="card-text text-muted">
                                Behavioral drift measures the change in performance between G1 and G2 periods. 
                                <strong>Positive drift</strong> indicates improvement, <strong>negative drift</strong> shows decline, 
                                and <strong>stable</strong> means consistent performance. This helps identify students 
                                who may need additional support or recognition.
                            </p>
                            <p class="card-text">
                                <small class="text-muted">
                                    <strong>Your Drift:</strong> 
                                    <span class="badge {% if drift_status == 'Positive' %}bg-success{% elif drift_status == 'Negative' %}bg-danger{% else %}bg-info{% endif %}">
                                        {{ drift_status }}
                                    </span>
                                </small>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Clustering Explanation -->
                <div class="col-md-4">
                    <div class="card shadow-sm border-0 h-100">
                        <div class="card-body">
                            <h5 class="card-title text-primary">
                                <i class="bi bi-diagram-3"></i> Behavior Clustering
                            </h5>
                            <p class="card-text text-muted">
                                Students are grouped into clusters based on similar learning patterns. Each cluster 
                                represents a distinct behavioral profile. This helps educators understand student 
                                groups and tailor interventions accordingly.
                            </p>
                            <p class="card-text">
                                <small class="text-muted">
                                    <strong>Your Cluster:</strong> 
                                    <span class="badge bg-info">Cluster {{ cluster }}</span>
                                </small>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="row">
                <div class="col-12 text-center">
                    <a href="/" class="btn btn-primary btn-lg me-2">
                        <i class="bi bi-arrow-left"></i> New Prediction
                    </a>
                    <button onclick="window.print()" class="btn btn-outline-secondary btn-lg">
                        <i class="bi bi-printer"></i> Print Results
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Add fade-in animation
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });

            // Cluster Visualization Chart
            const clusterCtx = document.getElementById('clusterChart');
            if (clusterCtx) {
                const clusterColors = ['#0d6efd', '#198754', '#ffc107'];
                const currentCluster = {{ cluster }};
                new Chart(clusterCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Study Time', 'Absences', 'Failures', 'G1 Grade', 'G2 Grade'],
                        datasets: [{
                            label: 'Your Profile',
                            data: [
                                {{ cluster_features.studytime }},
                                {{ cluster_features.absences }},
                                {{ cluster_features.failures }},
                                {{ cluster_features.G1 }},
                                {{ cluster_features.G2 }}
                            ],
                            backgroundColor: clusterColors[currentCluster],
                            borderColor: clusterColors[currentCluster],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            title: {
                                display: true,
                                text: 'Feature Values for Cluster {{ cluster }}'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 20
                            }
                        }
                    }
                });
            }

            // Grade Progression Chart
            const gradeCtx = document.getElementById('gradeChart');
            if (gradeCtx) {
                new Chart(gradeCtx, {
                    type: 'line',
                    data: {
                        labels: ['G1 (Period 1)', 'G2 (Period 2)', 'G3 (Predicted Final)'],
                        datasets: [{
                            label: 'Grade',
                            data: [{{ G1 }}, {{ G2 }}, {{ final_grade }}],
                            borderColor: '#0d6efd',
                            backgroundColor: 'rgba(13, 110, 253, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#0d6efd',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            title: {
                                display: true,
                                text: 'Grade Progression Over Time'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 20,
                                title: {
                                    display: true,
                                    text: 'Grade (out of 20)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Academic Period'
                                }
                            }
                        }
                    }
                });
            }

            // Feature Comparison Radar Chart
            const featureCtx = document.getElementById('featureChart');
            if (featureCtx) {
                // Normalize values for radar chart (0-1 scale)
                const maxValues = {study: 20, absences: 100, failures: 10, grade: 20};
                const normalizedData = {
                    study: {{ cluster_features.studytime }} / maxValues.study,
                    absences: 1 - ({{ cluster_features.absences }} / maxValues.absences), // Inverted (lower is better)
                    failures: 1 - ({{ cluster_features.failures }} / maxValues.failures), // Inverted (lower is better)
                    g1: {{ cluster_features.G1 }} / maxValues.grade,
                    g2: {{ cluster_features.G2 }} / maxValues.grade
                };

                new Chart(featureCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Study Time', 'Attendance', 'No Failures', 'G1 Performance', 'G2 Performance'],
                        datasets: [{
                            label: 'Your Profile',
                            data: [
                                normalizedData.study,
                                normalizedData.absences,
                                normalizedData.failures,
                                normalizedData.g1,
                                normalizedData.g2
                            ],
                            backgroundColor: 'rgba(13, 110, 253, 0.2)',
                            borderColor: '#0d6efd',
                            borderWidth: 2,
                            pointBackgroundColor: '#0d6efd',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            title: {
                                display: true,
                                text: 'Feature Profile (Normalized)'
                            }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 1,
                                ticks: {
                                    stepSize: 0.2
                                }
                            }
                        }
                    }
                });
            }

            // Drift Visualization Chart
            const driftCtx = document.getElementById('driftChart');
            if (driftCtx) {
                const driftValue = {{ drift }};
                const driftColor = driftValue > 2 ? '#198754' : (driftValue < -2 ? '#dc3545' : '#0dcaf0');
                
                new Chart(driftCtx, {
                    type: 'bar',
                    data: {
                        labels: ['G1', 'G2', 'Drift (G2-G1)'],
                        datasets: [{
                            label: 'Value',
                            data: [{{ G1 }}, {{ G2 }}, driftValue],
                            backgroundColor: ['#6c757d', '#6c757d', driftColor],
                            borderColor: ['#495057', '#495057', driftColor],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Grade Comparison & Drift'
                            },
                            annotation: {
                                annotations: {
                                    line1: {
                                        type: 'line',
                                        yMin: 0,
                                        yMax: 0,
                                        borderColor: 'rgb(255, 99, 132)',
                                        borderWidth: 2
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'Grade / Drift Value'
                                },
                                grid: {
                                    color: function(context) {
                                        if (context.tick.value === 0) {
                                            return 'rgba(255, 99, 132, 0.5)';
                                        }
                                        return 'rgba(0, 0, 0, 0.1)';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>